import{_wcl}from"./common-lib.js";import{_wccss}from"./common-css.js";import{colorPalette as _fujiColorPalette,input as _fujiInput,buttons as _fujiButtons}from"./fuji-css.js";import Mustache from"./mustache.js";import"https://unpkg.com/yahoo-pixelframe-uploader/wc-yahoo-pixelframe-uploader.js";import"https://unpkg.com/msc-dialogs/wc-msc-dialogs.js";import"https://unpkg.com/msc-circle-progress/wc-msc-circle-progress.js";const blankImage="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",defaults={maxpickcount:1,maxuploadcount:100,placeholder:"Search video",uploader:{multiple:!0,accept:".mov,.mp4,.ogg,.webm",imagelimitation:{minwidth:100,minheight:100,size:52428800},videolimitation:{minwidth:100,minheight:100,size:314572800,duration:3600},maximagecount:0,maxvideocount:20,webservice:{token:{url:"https://trendr-apac.media.yahoo.com/api/pixelframe/v1/aws/resources/s3/credentials?role=content-upload"},upload:{urls:{video:"https://trendr-apac.media.yahoo.com/api/pixelframe/v1/videos/upload",image:"https://trendr-apac.media.yahoo.com/api/pixelframe/v1/images/upload"},params:{targetType:"videolibrary",targetId:"auction2",appName:"auction",resizingProfile:"auction",transcodingProfile:"auction"}}}}},booleanAttrs=[],objectAttrs=["uploader"],custumEvents={pick:"yahoo-pixelframe-drive-pick"},isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),template=document.createElement("template"),templateUnit=(template.innerHTML=`
<style>
${_wccss}
${_fujiColorPalette}
${_fujiInput}
${_fujiButtons}

:host {
  position: relative;
  display: block;
}

.main {
  --dialog-drive-inline-size: var(--yahoo-pixelframe-drive-drive-inline-size, 800px);

  /* text content */
  --dialog-drive-title: var(--yahoo-pixelframe-drive-drive-title, 'Video Library');
  --dialog-edit-title: var(--yahoo-pixelframe-drive-edit-title, 'Edit Video');
  --dialog-delete-title: var(--yahoo-pixelframe-drive-delete-title, 'Delete Video');
  --dd-hint: var(--yahoo-pixelframe-drive-drag-n-drop-hint, 'Drop video(s) here.');

  --dialog-drive-button-confirm: var(--yahoo-pixelframe-drive-drive-button-confirm-text, 'CONFIRM');
  --dialog-edit-button-confirm: var(--yahoo-pixelframe-drive-edit-button-confirm-text, 'CONFIRM');
  --dialog-edit-button-cancel: var(--yahoo-pixelframe-drive-edit-button-cancel-text, 'CANCEL');

  --dialog-delete-button-confirm: var(--yahoo-pixelframe-drive-delete-button-confirm-text, 'DELETE');
  --dialog-delete-button-cancel: var(--yahoo-pixelframe-drive-delete-button-cancel-text, 'CANCEL');

  --dialog-drive-no-result: var(--yahoo-pixelframe-drive-drive-no-result-text, 'No video exists.');

  --dialog-background-color: var(--yahoo-pixelframe-drive-dialog-background-color, rgba(255 255 255));
  --dialogs-title-color: var(--yahoo-pixelframe-drive-dialog-title-color, rgba(70 78 86));
  --dialogs-title-border-color: var(--yahoo-pixelframe-drive-dialog-title-border-color, rgba(130 138 147));

  --hr-color: var(--yahoo-pixelframe-drive-hr-color, rgba(224 228 233));

  --listing-no-result-text-color: var(--yahoo-pixelframe-drive-drive-no-result-text-color, rgba(70 78 86));

  --form-background-color-normal: var(--yahoo-pixelframe-drive-drive-search-normal-background-color, rgba(240 243 245));
  --form-background-color-active: var(--yahoo-pixelframe-drive-drive-search-active-background-color, rgba(224 228 233));
  --form-background-color: var(--form-background-color-normal);
  --form-input-color: var(--yahoo-pixelframe-drive-drive-search-input-color, rgba(35 42 49));
  --form-input-placeholder-color: var(--yahoo-pixelframe-drive-drive-search-input-placeholder-color, rgba(151 158 168));
  --form-search-icon-color: var(--yahoo-pixelframe-drive-drive-search-icon-color, rgba(35 42 49));
  --form-border-color: var(--yahoo-pixelframe-drive-drive-search-border-color, rgba(199 205 210));

  --listing-border-color: var(--yahoo-pixelframe-drive-drive-listing-border-color, rgba(224 228 233));
  --listing-overlay-background: var(--yahoo-pixelframe-drive-drive-listing-overlay-background, rgba(255 255 255/.35));

  --ft-info-color: var(--yahoo-pixelframe-drive-drive-pick-info-text-color, rgba(35 42 49));

  --button-accent-color: var(--yahoo-pixelframe-drive-action-button-accent-color, rgba(15 105 255));
  --button-inert-color: var(--yahoo-pixelframe-drive-action-button-inert-color, rgba(176 185 193));

  --add-video-button-icon-color: var(--yahoo-pixelframe-drive-drive-add-button-icon-color, rgba(230 50 89));
  --add-video-button-icon-inert-color: var(--yahoo-pixelframe-drive-drive-add-button-icon-inert-color, rgba(176 185 193));
  --add-video-button-active-background-color: var(--yahoo-pixelframe-drive-drive-add-button-active-background-color, rgba(242 242 242));

  --dialog-delete-title-text-color: var(--yahoo-pixelframe-drive-delete-title-text-color, rgba(35 42 49));
  --dialog-delete-description-text-color: var(--yahoo-pixelframe-drive-delete-description-text-color, rgba(176 185 193));

  --dialog-edit-input-background-color: var(--yahoo-pixelframe-drive-edit-input-background-color, rgba(255 255 255));
  --dialog-edit-input-text-color: var(--yahoo-pixelframe-drive-edit-input-text-color, rgba(35 42 49));
  --dialog-edit-input-border-color: var(--yahoo-pixelframe-drive-edit-input-border-color, rgba(110 119 128));
  --dialog-edit-input-placeholder-color: var(--yahoo-pixelframe-drive-edit-input-placeholder-color, rgba(70 78 86));
  --dialog-edit-input-label-text-color: var(--yahoo-pixelframe-drive-edit-input-label-text-color, rgba(110 119 128));
  --dialog-edit-input-theme-color: var(--yahoo-pixelframe-drive-edit-input-theme-color, rgba(15 105 255));

  --dd-hint-text-color: var(--yahoo-pixelframe-drive-drag-n-drop-hint-text-color, rgba(255 255 255));
  --dd-hint-overlay-color: var(--yahoo-pixelframe-drive-drag-n-drop-hint-overlay-color, rgba(0 0 0/.8));

  /* msc-dialogs */
  --msc-dialogs-margin: 24px;
  --msc-dialogs-padding: 24px;

  /* icon */
  --icon-search: path('M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z');
  --icon-add-circle: path('M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z');
  --icon-check: path('M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z');
  --icon-delete-forever: path('M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12l1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z');
  --icon-edit: path('M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z');

  /* dialogs-hr */
  --hr-margin: .75em;
  --hr-size: calc(var(--hr-margin) * 2 + 1px);

  /* dialogs-title */
  --dialogs-title-font-size: 1.125em;
  --dialogs-title-border-size: 1px;
  --dialogs-title-padding-block-end: 16px;
  --dialogs-title-block-size: calc(
    var(--dialogs-title-font-size)
    + var(--dialogs-title-padding-block-end)
    + var(--dialogs-title-border-size)
  );

  @media screen and (max-width: 767px) {
    --msc-dialogs-margin: 0px;
    --msc-dialogs-padding: 16px;
    --msc-dialogs-button-size: 32;
    --msc-dialogs-button-inset-inline-end: 8px;
    --msc-dialogs-button-inset-block-start: 8px;

    --dialogs-title-padding-block-end: 12px;
  }

  position: relative;
  outline: 0 none;

  .dialogs-hr {
    border: 0 none;
    border-top: 1px solid var(--hr-color);
    margin: var(--hr-margin);
  }

  .dialogs-title {
    font-size: var(--dialogs-title-font-size);
    font-weight: 500;
    line-height: 1;
    color: var(--dialogs-title-color);
    border-block-end: var(--dialogs-title-border-size) solid var(--dialogs-title-border-color);
    padding-block-end: var(--dialogs-title-padding-block-end);
    margin-block-end: var(--dialogs-title-padding-block-end);
  }
}

/* drive */
.drive {
  --main-padding: 0em;
  --main-inline-size: min(
    var(--dialog-drive-inline-size),
    calc(
      80dvi
      - (var(--msc-dialogs-margin) * 2)
      - (var(--msc-dialogs-padding) * 2)
    )
  );
  --ft-block-size: 36px;

  /* functions */
  --function-block-size: 48;
  --function-block-size-with-unit: calc(var(--function-block-size) * 1px);
  --function-icon-scale-rate: .75;
  --function-icon-scale-basis: calc((var(--function-block-size) * var(--function-icon-scale-rate)) / 24);
  --function-add-icon-color: var(--add-video-button-icon-color);
  --function-add-icon-color--inert: var(--add-video-button-icon-inert-color);

  --function-add-background-color-normal: transparent;
  --function-add-background-color-active: var(--add-video-button-active-background-color);
  --function-add-background-color: var(--function-add-background-color-normal);

  /* form */
  --form-block-size: 3em;
  --form-arrow-size: 4px;
  --form-gap: .5em;
  --form-padding-inline: 1em;

  /* listings */
  --listing-column-count: 3;
  --listing-gap: .75em;
  --listing-inline-size: calc((100% - ((var(--listing-column-count) - 1) * var(--listing-gap))) / var(--listing-column-count));
  --listing-button-margin: 6px;
  --listing-button-size: 28px;
  --listing-progress-size: 20px;
  --listing-checkmark-size: 28px;
  --listing-checkmark-background-color: rgba(56 113 227);
  --listing-min-block-size: 240px;
  --listing-max-block-size: calc(
    90dvb
    - var(--msc-dialogs-margin) * 2
    - var(--msc-dialogs-padding) * 2
    - var(--dialogs-title-block-size)
    - var(--function-block-size-with-unit)
    - var(--main-padding) * 2
    - var(--hr-size) * 2
    - var(--ft-block-size)
  );
  --listing-min-block-size: min(240px, var(--listing-max-block-size));
  --listing-no-result-text: var(--dialog-drive-no-result);

  /* ft */
  --ft-info-color--inert: rgba(176 185 193);
  --ft-visibility: visible;

  /* overlay */
  --overlay-opacity-normal: 0;
  --overlay-opacity-active: 1;
  --overlay-opacity: var(--overlay-opacity-normal);

  --overlay-pointer-events-normal: none; 
  --overlay-pointer-events-active: auto; 
  --overlay-pointer-events: var(--overlay-pointer-events-normal);

  inline-size: var(--main-inline-size);
  background-color: var(--dialog-background-color);
  box-sizing: border-box;
  padding: var(--main-padding);
  outline: 0 none;
  container-type: inline-size;

  @media screen and (max-width: 767px) {
    --main-inline-size: 100%;
  }

  @container (width >= 300px) {
    .drive__gallery {
      --listing-column-count: 3;
    }
  }

  @container (width >= 500px) {
    .drive__gallery {
      --listing-column-count: 4;
    }
  }

  @container (width >= 600px) {
    .drive__gallery {
      --listing-column-count: 5;
    }
  }

  @container (width >= 800px) {
    .drive__gallery {
      --listing-column-count: 6;
    }
  }

  &:not(:has(:nth-child(1 of .drive__gallery__unit))) {
    --ft-button-confirm-color: var(--ft-button-confirm-color--inert);
    --ft-info-color: var(--ft-info-color--inert);
    --ft-visibility: hidden;
  }

  &.drive--over {
    --overlay-opacity: var(--overlay-opacity-active);
    --overlay-pointer-events: var(--overlay-pointer-events-active);
  }

  .drive__wrap {
    position: relative;

    &::before {
      content: var(--dd-hint);

      position: absolute;
      inset: 0;
      font-size: 1.125em;
      color: var(--dd-hint-text-color);
      background-color: var(--dd-hint-overlay-color);
      z-index: 1;
      pointer-events: var(--overlay-pointer-events);
      border-radius: 1em;

      display: grid;
      place-content: center;

      opacity: var(--overlay-opacity);
      will-change: opacity;
      transition: opacity .15s ease;
    }
  }

  .drive__functions {
    display: flex;
    align-items: center;
    gap: .5em;

    yahoo-pixelframe-uploader[inert] {
      --function-add-icon-color: var(--function-add-icon-color--inert);
    }

    .drive__functions__trigger {
      flex-shrink: 0;
      font-size: 0;
      appearance: none;
      box-shadow: unset;
      border: unset;
      background: transparent;
      -webkit-user-select: none;
      user-select: none;
      pointer-events: auto;
      margin: 0;
      padding: 0;
      outline: 0 none;

      inline-size: var(--function-block-size-with-unit);
      aspect-ratio: 1/1;
      border-radius: var(--function-block-size-with-unit);
      background-color: var(--function-add-background-color);
      display: grid;
      place-content: center;
      transition: background-color .15s ease;
      will-change: background-color;

      &:active {
        scale: .85;
      }

      &:focus {
        --function-add-background-color: var(--function-add-background-color-active);
      }

      &::before {
        content: '';
        inline-size: 24px;
        aspect-ratio: 1/1;
        background-color: var(--function-add-icon-color);
        clip-path: var(--icon-add-circle);
        scale: var(--function-icon-scale-basis);
      }

      @media (hover: hover) {
        &:hover {
          --function-add-background-color: var(--function-add-background-color-active);
        }
      }
    }

    search {
      flex-grow: 1;
      min-inline-size: 0;
    }

    .drive__search__form {
      font-size: 1em;
      inline-size: 100%;
      block-size: var(--function-block-size-with-unit);
      border-radius: var(--function-block-size-with-unit);
      background-color: var(--form-background-color);
      box-sizing: border-box;
      padding-inline: var(--form-padding-inline);
      transition: background-color .15s ease;
      will-change: background-color;

      display: flex;
      align-items: center;

      @media (hover: hover) {
        &:hover {
          --form-background-color: var(--form-background-color-active);
        }
      }

      &:focus-within {
        --form-background-color: var(--form-background-color-active);
      }

      .drive__search__form__label {
        block-size: var(--form-block-size);
        display: flex;
        align-items: center;

        &:has(input) {
          flex-grow: 1;
          min-inline-size: 0;

          &::before {
            flex-shrink: 0;
            content: '';
            inline-size: 24px;
            aspect-ratio: 1/1;
            background-color: var(--form-search-icon-color);
            clip-path: var(--icon-search);
          }
        }

        &:has(select) {
          position: relative;

          &:after {
            position: absolute;
            flex-shrink: 0;
            content: '';
            inline-size: 0;
            block-size: 0;

            inset-inline-end: 0;
            inset-block-start: calc(50% + (var(--form-arrow-size) / 2));
            translate: 0 -50%; 

            border: var(--form-arrow-size) solid transparent;
            border-block-start-color: var(--form-input-color);
            pointer-events: none;
          }
        }
      }

      input,
      select {
        flex-grow: 1;

        font-size: inherit;
        color: var(--form-input-color);
        line-height: 2;
        text-overflow: ellipsis;

        min-inline-size: 0;
        box-sizing:border-box;
        background: transparent;
        appearance: none;
        -webkit-appearance: none;
        border: 0 none;
        resize: none;
        outline: 0 none;
        display: block;

        padding-inline: var(--form-gap);
      }

      input::placeholder {
        color: var(--form-input-placeholder-color);
      }

      select {
        flex-grow: revert;
        flex-shrink: 0;
        field-sizing: content;

        padding-inline: 1em;
        border-inline-start: 1px solid var(--form-border-color);
      }

      .drive__search__form__prevent-submit {
        display: none;
      }
    }
  }

  .drive__main {
    position: relative;
    display: block;

    &:has(.drive__gallery:empty)::after {
      position: absolute;
      inset-inline-start: 50%;
      inset-block-start: 50%;
      translate: -50% -50%;

      content: var(--listing-no-result-text);
      font-size: 1.25em;
      color: var(--listing-no-result-text-color);
    }

    .drive__main__action {
      visibility: var(--ft-visibility);
      display: flex;
      gap: 1em;
      align-items: center;

      .drive__main__action__info {
        flex-shrink: 0;
        color: var(--ft-info-color);
      }

      .buttons[data-type='secondary1'] {
        --default-text-color: var(--button-accent-color);

        flex-grow: 1;
        min-inline-size: 0;

        &[inert] {
          --default-text-color: var(--button-inert-color);
        }
      }
    }
  }

  .drive__gallery {
    --fade-in-out-min-block-size: var(--listing-min-block-size);
    --fade-in-out-max-block-size: var(--listing-max-block-size);
    --listing-inline-size: calc((100% - ((var(--listing-column-count) - 1) * var(--listing-gap))) / var(--listing-column-count));

    position: relative;
    display: flex;
    gap: var(--listing-gap);
    flex-wrap: wrap;
    align-items: flex-start;
    align-content: flex-start;

    &:empty {
      mask-image: initial;
      -webkit-mask-image: initial;
    }

    .drive__gallery__unit {
      --warn-bar-size: .75em;
      --warn-bar-strip-start-color: #de2f21;
      --warn-bar-strip-end-color: rgba(0 0 0);
      --warn-scale-normal: .001;
      --warn-scale-active: 1;
      --warn-scale: var(--warn-scale-normal);

      --checkmark-opacity-normal: 0;
      --checkmark-opacity-active: 1;
      --checkmark-opacity: var(--checkmark-opacity-normal);
      
      --checkmark-scale-normal: .001;
      --checkmark-scale-active: 1;
      --checkmark-scale: var(--checkmark-scale-normal);

      --overlay-opacity-normal: 0;
      --overlay-opacity-active: 1;
      --overlay-opacity: var(--overlay-opacity-normal);

      --button-opacity-normal: 0;
      --button-opacity-active: 1;
      --button-opacity: var(--button-opacity-normal);
      
      --button-scale-normal: .001;
      --button-scale-active: 1;
      --button-scale: var(--button-scale-normal);

      --progress-opacity-normal: 1;
      --progress-opacity-active: 0;
      --progress-opacity: var(--progress-opacity-normal);

      --progress-scale-normal: 1;
      --progress-scale-active: .001;
      --progress-scale: var(--progress-scale-normal);

      position: relative;
      inline-size: var(--listing-inline-size);
      aspect-ratio: 1/1;
      border-radius: .5em;
      overflow: hidden;
      box-sizing: border-box;
      border: 1px solid var(--listing-border-color);

      @media (hover: hover) {
        &[data-status=done]:not(:has(:checked)):hover {
          --button-opacity: var(--button-opacity-active);
          --button-scale: var(--button-scale-active);
        }
      }

      @media not (hover: hover) {
        &[data-status=done]:not(:has(:checked)) {
          --button-opacity: var(--button-opacity-active);
          --button-scale: var(--button-scale-active);
        }
      }

      &.drive__gallery__unit--remove {
        animation: animate-remove-gallery-unit .35s ease-in-out forwards;
      }

      &[data-status=done] {
        --progress-opacity: var(--progress-opacity-active);
        --progress-scale: var(--progress-scale-active);
      }

      &[data-status=error] {
        --warn-scale: var(--warn-scale-active);
        --progress-opacity: var(--progress-opacity-active);
        --progress-scale: var(--progress-scale-active);

        [data-action=delete] {
          --button-opacity: var(--button-opacity-active);
          --button-scale: var(--button-scale-active);
        }
      }

      &:has(input:checked) {
        --checkmark-opacity: var(--checkmark-opacity-active);
        --checkmark-scale: var(--checkmark-scale-active);
        --overlay-opacity: var(--overlay-opacity-active);
        --button-opacity: var(--button-opacity-normal);
        --button-scale: var(--button-scale-normal);
      }

      &[data-status=done]:active {
        scale: .95;
      }

      label {
        position: relative;
        inline-size: 100%;
        block-size: 100%;
        display: block;

        &::before {
          content: '';
          position: absolute;
          inset: 0;
          margin: 0;
          background: var(--listing-overlay-background);
          opacity: var(--overlay-opacity);
          transition: opacity .15s ease;
          will-change: opacity;
          z-index: 1;
        }
      }

      input {
        position: absolute;
        inset: -100% auto auto 0;
      }

      img {
        inline-size: 100%;
        block-size: 100%;
        display: block;
        object-fit: cover;
        border-radius: inherit;
      }

      .drive__gallery__unit__checkmark {
        position: absolute;
        inset: 0 auto auto 0;
        inline-size: var(--listing-checkmark-size);
        block-size: var(--listing-checkmark-size);
        background-color: var(--listing-checkmark-background-color);
        border-radius: var(--listing-checkmark-size);
        margin: var(--listing-button-margin);
        display: grid;
        place-content: center;
        opacity: var(--checkmark-opacity);
        scale: var(--checkmark-scale);
        transition: opacity .15s ease,scale .15s ease;
        will-change: opacity,scale;
        pointer-events: none;
        z-index: 2;

        border: 2px solid rgba(255 255 255);
        box-sizing: border-box;

        &::before {
          content: '';
          inline-size: 24px;
          aspect-ratio: 1/1;
          background-color: rgba(255 255 255);
          clip-path: var(--icon-check);
          display: block;
          scale: .75;
        }
      }

      .drive__gallery__unit__button {
        --inset: 0;
        --icon: initial;

        flex-shrink: 0;
        font-size: 0;
        appearance: none;
        box-shadow: unset;
        border: unset;
        background: transparent;
        -webkit-user-select: none;
        user-select: none;
        pointer-events: auto;
        margin: 0;
        padding: 0;
        outline: 0 none;

        position: absolute;
        inset: var(--inset);
        inline-size: var(--listing-button-size);
        aspect-ratio: 1/1;
        border-radius: var(--listing-button-size);
        background-color: rgba(0 0 0/.7);
        margin: var(--listing-button-margin);
        display: grid;
        place-content: center;
        opacity: var(--button-opacity);
        scale: var(--button-scale);
        transition: opacity .15s ease,scale .15s ease;
        will-change: opacity,scale;
        z-index: 1;

        &:active {
          scale: .9;
        }

        &::before {
          content: '';
          inline-size: 24px;
          aspect-ratio: 1/1;
          background-color: rgba(255 255 255);
          clip-path: var(--icon);
          display: block;
          scale: .9;
        }

        &[data-action=delete] {
          --inset: auto 0 0 auto;
          --icon: var(--icon-delete-forever);
        }

        &[data-action=edit] {
          --inset: auto auto 0 0;
          --icon: var(--icon-edit);
        }
      }

      .drive__gallery__unit__progress {
        --msc-circle-progress-font-color: transparent;
        --msc-circle-progress-color: #fff;

        position: absolute;
        inset: auto 0 0 auto;
        inline-size: var(--listing-button-size);
        aspect-ratio: 1/1;
        border-radius: var(--listing-button-size);
        background-color: rgba(0 0 0/.7);
        margin: var(--listing-button-margin);
        display: grid;
        place-content: center;
        pointer-events: none;

        opacity: var(--progress-opacity);
        scale: var(--progress-scale);
        transition: opacity .15s ease,scale .15s ease;
        will-change: opacity,scale;

        msc-circle-progress {
          inline-size: var(--listing-progress-size);
        }
      }

      .drive__gallery__unit__warn {
        position: absolute;
        inset-inline-start: 0;
        inset-block-start: 0;
        inline-size: 100%;
        block-size: 100%;
        background-color: rgba(255 0 0/.3);
        pointer-events: none;
        animation: animate-warn 1s ease-in-out infinite;

        transition: scale .15s ease-in-out;
        will-change: scale;
        scale: var(--warn-scale);

        overflow: hidden;
        pointer-events: none;

        &::before,
        &::after {
          position: absolute;
          inset-inline-start: 0;
          inline-size: 100%;
          block-size: var(--warn-bar-size);
          content: '';
          background-size: 24px var(--warn-bar-size);
          background-image: -webkit-linear-gradient(-45deg, var(--warn-bar-strip-start-color) 33%, var(--warn-bar-strip-end-color) 33%, var(--warn-bar-strip-end-color) 66%, var(--warn-bar-strip-start-color) 66%);
        }

        &::before {
          inset-block-start: 0;
          animation: animate-warn-bar-block-start 60s linear infinite;
        }

        &::after {
          inset-block-end: 0;
          animation: animate-warn-bar-block-end 60s linear infinite;
        }

        .drive__gallery__unit__warn__span {
          position: absolute;
          inset-block: 0;
          margin: auto;
          inline-size: 100%;
          block-size: fit-content;
          display: block;
          background-color: rgba(0 0 0/.75);
          color: var(--warn-bar-strip-start-color);
          line-height: 2.2;
          text-align: center;
          font-size: 1em;
          font-weight: 800;
          border-block-start: 2px solid var(--warn-bar-strip-start-color);
          border-block-end: 2px solid var(--warn-bar-strip-start-color);
        }
      }
    }
  }
}

@keyframes animate-warn-bar-block-start {
  100% { background-position: -3000% 0px; }
}

@keyframes animate-warn-bar-block-end {
  100% { background-position: 3000% 0px; }
}

@keyframes animate-warn {
  0% { opacity: .5; }
  50% { opacity: 1; }
  100%{ opacity: .5; }
}

@keyframes animate-remove-gallery-unit {
  0% { opacity: 1; translate: 0% 0%; }
  100% { opacity: 0; translate: 0% -35%; }
}

/* video-dialog */
.video-dialog {
  --default-theme: rgba(56 113 227);
  --default-accent-color: rgba(56 113 227);
  --main-inline-size: min(
    440px,
    calc(
      80dvi
      - (var(--msc-dialogs-margin) * 2)
      - (var(--msc-dialogs-padding) * 2)
    )
  );

  @media screen and (max-width: 767px) {
    --main-inline-size: 100%;
  }

  inline-size: var(--main-inline-size);
  box-sizing: border-box;
  background-color: var(--dialog-background-color);
  
  .video-dialog__info {
    margin-block-start: 1.5em;
    display: flex;
    gap: 1em;
    align-items: flex-start;

    img {
      flex-shrink: 0;
      inline-size: 7.5em;
      aspect-ratio: 1/1;
      object-fit: cover;
      display: block;
      border: 1px solid var(--listing-border-color);
      border-radius: 1em;
      box-sizing: border-box;
    }

    .video-dialog__info__contents {
      flex-grow: 1;
      min-inline-size: 0;
      display: flex;
      flex-direction: column;
      gap: 1em;

      .video-dialog__info__contents__title {
        font-size: 1.125em;
        font-weight: 500;
        color: var(--dialog-delete-title-text-color);
      }

      .video-dialog__info__contents__description {
        font-size: .875em;
        color: var(--dialog-delete-description-text-color);
      }

      .input-set {
        --default-background-color: var(--dialog-edit-input-background-color);
        --default-text-color: var(--dialog-edit-input-text-color);
        --default-border-color: var(--dialog-edit-input-border-color);
        --default-placeholder-text-color: var(--dialog-edit-input-placeholder-color);
        --default-label-text-color: var(--dialog-edit-input-label-text-color);
        --default-theme: var(--dialog-edit-input-theme-color);
      }
    }
  }

  .video-dialog__actions {
    inline-size: 100%;
    display: flex;
    gap: 1em;
    align-items: center;
    justify-content: end;

    .buttons[data-type='primary'],
    .buttons[data-type='secondary1'] {
      --default-background-color: var(--button-accent-color);
      --default-text-color: var(--button-accent-color);

      &[inert] {
        --default-text-color: var(--button-inert-color);
      }
    }
  }
}

.dialog-drive {
  .dialogs-title::before {
    content: var(--dialog-drive-title);
  }

  .buttons span::before {
    content: var(--dialog-drive-button-confirm);
  }
}

.dialog-edit {
  .dialogs-title::before {
    content: var(--dialog-edit-title);
  }

  .buttons[value=submit] span::before {
    content: var(--dialog-edit-button-confirm);
  }

  .buttons[value=cancel] span::before {
    content: var(--dialog-edit-button-cancel);
  }
}

.dialog-delete {
  .dialogs-title::before {
    content: var(--dialog-delete-title);
  }

  .buttons[value=submit] span::before {
    content: var(--dialog-delete-button-confirm);
  }

  .buttons[value=cancel] span::before {
    content: var(--dialog-delete-button-cancel);
  }
}
</style>

<div class="main" ontouchstart="" tabindex="0">
  <!-- drive -->
  <msc-dialogs class="dialog-drive">
    <div class="drive" tabindex="0">
      <p class="dialogs-title"></p>

      <div class="drive__wrap">
        <div class="drive__functions">
          <yahoo-pixelframe-uploader>
            <script type="application/json">
${JSON.stringify(defaults.uploader,null,2)}
            </script>

            <div
              class="drive__functions__trigger"
              tabindex="0"
              role="button"
              slot="trigger"
            ></div>
          </yahoo-pixelframe-uploader>

          <search>
            <form class="drive__search__form" autocorrect="off" autocomplete="off" autocapitalize="off">
              <label class="drive__search__form__label">
                <input type="search" name="q" placeholder="${defaults.placeholder}" />
              </label>

              <!--
              <label class="drive__search__form__label">
                <select name="sort">
                  <option disabled>Category</option>
                  <hr />
                  <option value="all">All</option>
                  <option value="toys">Toys</option>
                  <option value="video-games">Video Games</option>
                </select>
              </label>
              -->

              <input type="text" class="drive__search__form__prevent-submit" name="prevent-submit">
            </form>
          </search>
        </div>

        <hr class="dialogs-hr" />

        <form class="drive__main">
          <div class="drive__gallery fade-in-out"></div>
        
          <hr class="dialogs-hr" />

          <div class="drive__main__action">
            <span class="drive__main__action__info">
              <em class="drive__main__action__info__pickcount">0</em> / <em class="drive__main__action__info__maxpickcount">${defaults.maxpickcount}</em>
            </span>
            <button
              type="submit"
              class="buttons"
              data-type="secondary1"
              data-size="medium"
              inert
            >
              <span></span> 
            </button>
          </div>
        </form>
      </div>
    </div>
  </msc-dialogs>

  <!-- edit -->
  <msc-dialogs class="dialog-edit">
    <form class="video-dialog" autocorrect="off" autocomplete="off" autocapitalize="off">
      <p class="dialogs-title"></p>

      <div class="video-dialog__info">
        <img src="${blankImage}" loading="eager" data-ref="image" />
        <div class="video-dialog__info__contents">
          <div class="input-set esc-dark-mode">
            <input name="title" type="text" placeholder="input video title" value="" data-ref="name" />
            <label class="input-set__label">
              <span class="input-set__label__span">Title</span>
            </label>
            <em class="input-set__em"></em>
          </div>

          <div class="input-set esc-dark-mode">
            <textarea name="description" placeholder="input video description" data-ref="description"></textarea>
            <label class="input-set__label">
              <span class="input-set__label__span">Description</span>
            </label>
            <em class="input-set__em"></em>
          </div>

          <input type="hidden" name="id" data-ref="id" />
        </div>
      </div>

      <hr class="dialogs-hr" />

      <div class="video-dialog__actions" >
        <button
          type="submit"
          class="buttons"
          data-type="primary"
          data-size="medium"
          value="submit"
        >
          <span></span> 
        </button>

        <button
          type="submit"
          class="buttons"
          data-type="secondary1"
          data-size="medium"
          value="cancel"
        >
          <span></span>  
        </button>
      </div>
    </form>
  </msc-dialogs>

  <!-- delete -->
  <msc-dialogs class="dialog-delete">
    <form class="video-dialog" autocorrect="off" autocomplete="off" autocapitalize="off">
      <p class="dialogs-title"></p>

      <div class="video-dialog__info">
        <img src="${blankImage}" loading="eager" data-ref="image" />
        <div class="video-dialog__info__contents">
          <p class="video-dialog__info__contents__title" data-ref="name"></p>
          <p class="video-dialog__info__contents__description pretty-paragraph" data-ref="description"></p>
        </div>

        <input type="hidden" name="id" data-ref="id" />
      </div>

      <hr class="dialogs-hr" />

      <div class="video-dialog__actions" >
        <button
          type="submit"
          class="buttons"
          data-type="primary"
          data-size="medium"
          value="submit"
        >
          <span></span>  
        </button>

        <button
          type="submit"
          class="buttons"
          data-type="secondary1"
          data-size="medium"
          value="cancel"
        >
          <span></span>
        </button>
      </div>
    </form>
  </msc-dialogs>
</div>
`,document.createElement("template"));if(templateUnit.innerHTML=`
{{#units}}
<div class="drive__gallery__unit" data-status="{{status}}" data-id="{{id}}">
  <label>
    <span class="drive__gallery__unit__checkmark"></span>
    
    {{#freeze}}
    <input type="checkbox" name="pickedVideoIds" value="{{id}}" disabled />
    {{/freeze}}

    {{^freeze}}
    <input type="checkbox" name="pickedVideoIds" value="{{id}}" />
    {{/freeze}}
    
    <img src="{{thumbnail}}" loading="lazy" />
    
    <div class="drive__gallery__unit__progress">
      <msc-circle-progress size="3" value="0" round></msc-circle-progress>
    </div>

    <div class="drive__gallery__unit__warn">
      <span class="drive__gallery__unit__warn__span">ERROR</span>
    </div>
  </label>

  <button
    type="button"
    class="drive__gallery__unit__button"
    data-action="delete"
    title="delete"
  >
    delete
  </button>
  <button
    type="button"
    class="drive__gallery__unit__button"
    data-action="edit"
    title="edit"
  >
    delete
  </button>
</div>
{{/units}}
`,CSS?.registerProperty)try{CSS.registerProperty({name:"--yahoo-pixelframe-drive-drive-inline-size",syntax:"<length>",inherits:!0,initialValue:"800px"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-dialog-background-color",syntax:"<color>",inherits:!0,initialValue:"rgba(255 255 255)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-dialog-title-color",syntax:"<color>",inherits:!0,initialValue:"rgba(70 78 86)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-dialog-title-border-color",syntax:"<color>",inherits:!0,initialValue:"rgba(130 138 147)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-hr-color",syntax:"<color>",inherits:!0,initialValue:"rgba(224 228 233)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drive-no-result-text-color",syntax:"<color>",inherits:!0,initialValue:"rgba(70 78 86)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drive-search-normal-background-color",syntax:"<color>",inherits:!0,initialValue:"rgba(240 243 245)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drive-search-active-background-color",syntax:"<color>",inherits:!0,initialValue:"rgba(224 228 233)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drive-search-input-color",syntax:"<color>",inherits:!0,initialValue:"rgba(35 42 49)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drive-search-input-placeholder-color",syntax:"<color>",inherits:!0,initialValue:"rgba(151 158 168)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drive-search-icon-color",syntax:"<color>",inherits:!0,initialValue:"rgba(35 42 49)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drive-search-border-color",syntax:"<color>",inherits:!0,initialValue:"rgba(199 205 210)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drive-listing-border-color",syntax:"<color>",inherits:!0,initialValue:"rgba(224 228 233)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drive-listing-overlay-background",syntax:"<color>",inherits:!0,initialValue:"rgba(255 255 255/.35)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drive-pick-info-text-color",syntax:"<color>",inherits:!0,initialValue:"rgba(35 42 49)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-action-button-accent-color",syntax:"<color>",inherits:!0,initialValue:"rgba(15 105 255)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-action-button-inert-color",syntax:"<color>",inherits:!0,initialValue:"rgba(176 185 193)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drive-add-button-icon-color",syntax:"<color>",inherits:!0,initialValue:"rgba(230 50 89)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drive-add-button-icon-inert-color",syntax:"<color>",inherits:!0,initialValue:"rgba(176 185 193)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drive-add-button-active-background-color",syntax:"<color>",inherits:!0,initialValue:"rgba(242 242 242)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-delete-title-text-color",syntax:"<color>",inherits:!0,initialValue:"rgba(35 42 49)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-delete-description-text-color",syntax:"<color>",inherits:!0,initialValue:"rgba(176 185 193)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-edit-input-background-color",syntax:"<color>",inherits:!0,initialValue:"rgba(255 255 255)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-edit-input-text-color",syntax:"<color>",inherits:!0,initialValue:"rgba(35 42 49)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-edit-input-border-color",syntax:"<color>",inherits:!0,initialValue:"rgba(110 119 128)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-edit-input-placeholder-color",syntax:"<color>",inherits:!0,initialValue:"rgba(70 78 86)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-edit-input-label-text-color",syntax:"<color>",inherits:!0,initialValue:"rgba(110 119 128)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-edit-input-theme-color",syntax:"<color>",inherits:!0,initialValue:"rgba(15 105 255)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drag-n-drop-hint-text-color",syntax:"<color>",inherits:!0,initialValue:"rgba(255 255 255)"}),CSS.registerProperty({name:"--yahoo-pixelframe-drive-drag-n-drop-hint-overlay-color",syntax:"<color>",inherits:!0,initialValue:"rgba(0 0 0/.8)"})}catch(e){console.warn("yahoo-pixelframe-drive: "+e.message)}class YahooPixelframeDrive extends HTMLElement{#data;#nodes;#config;constructor(e){super(),this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.appendChild(template.content.cloneNode(!0)),this.#data={controller:"",dragCount:0,listings:{},orders:[]},this.#nodes={styleSheet:this.shadowRoot.querySelector("style"),main:this.shadowRoot.querySelector(".main"),uploader:this.shadowRoot.querySelector("yahoo-pixelframe-uploader"),dialogDrive:this.shadowRoot.querySelector(".dialog-drive"),dialogEdit:this.shadowRoot.querySelector(".dialog-edit"),dialogDelete:this.shadowRoot.querySelector(".dialog-delete"),drive:this.shadowRoot.querySelector(".dialog-drive .drive"),formDriveMain:this.shadowRoot.querySelector(".dialog-drive .drive__main"),formSearch:this.shadowRoot.querySelector(".drive__search__form"),formEdit:this.shadowRoot.querySelector(".dialog-edit .video-dialog"),formDelete:this.shadowRoot.querySelector(".dialog-delete .video-dialog"),gallery:this.shadowRoot.querySelector(".drive__gallery"),btnPick:this.shadowRoot.querySelector(".dialog-drive .drive__main .buttons"),infoMaxPickCount:this.shadowRoot.querySelector(".drive__main__action__info__maxpickcount"),infoPickCount:this.shadowRoot.querySelector(".drive__main__action__info__pickcount")},this.#config={...defaults,...e},this._uploaderHandler=this._uploaderHandler.bind(this),this._onGalleryClick=this._onGalleryClick.bind(this),this._onAnimationEnd=this._onAnimationEnd.bind(this),this._onDialogsClose=this._onDialogsClose.bind(this),this._editHandler=this._editHandler.bind(this),this._deleteHandler=this._deleteHandler.bind(this),this._onPick=this._onPick.bind(this),this._onSubmit=this._onSubmit.bind(this),this._onSearchInput=this._onSearchInput.bind(this),this._onDnD=this._onDnD.bind(this),this._hintHandler=this._hintHandler.bind(this)}async connectedCallback(){var{config:e,error:i}=await _wcl.getWCConfig(this);const{main:t,uploader:a,gallery:o,formDriveMain:r,formSearch:n,formEdit:l,formDelete:s,drive:c}=this.#nodes;if(i)console.warn(_wcl.classToTagName(this.constructor.name)+": "+i),this.remove();else{this.#config={...this.#config,...e},Object.keys(defaults).forEach(e=>this.#upgradeProperty(e)),this.#data.controller=new AbortController;const d=this.#data.controller.signal;i=customElements.get("yahoo-pixelframe-uploader")["supportedEvents"],e=(o.addEventListener("click",this._onGalleryClick,{signal:d}),o.addEventListener("animationend",this._onAnimationEnd,{signal:d}),r.addEventListener("input",this._onPick,{signal:d}),r.addEventListener("submit",this._onSubmit,{signal:d}),n.addEventListener("input",this._onSearchInput,{signal:d}),l.addEventListener("submit",this._editHandler,{signal:d}),l.addEventListener("input",this._editHandler,{signal:d}),s.addEventListener("submit",this._deleteHandler,{signal:d}),t.addEventListener("msc-dialogs-close",this._onDialogsClose,{signal:d}),i.forEach(e=>{a.addEventListener(e,this._uploaderHandler,{signal:d})}),["dragover","drop","paste"].forEach(e=>{c.addEventListener(e,this._onDnD,{signal:d,capture:!0})}),["dragover","dragleave"]);isSafari&&e.push("dragenter"),e.forEach(e=>{document.body.addEventListener(e,this._hintHandler,{signal:d,capture:!0})})}}disconnectedCallback(){this.#data?.controller&&this.#data.controller.abort()}#format(t,e,a){if(null!==a)switch(t){case"placeholder":this.#config[t]=a.trim()||defaults[t];break;case"maxuploadcount":case"maxpickcount":var i=+a;this.#config[t]=isNaN(i)||i<0?defaults[t]:i;break;case"uploader":{let i;try{i=JSON.parse(a)}catch(e){console.warn(_wcl.classToTagName(this.constructor.name)+": "+e.message),i=Array.isArray(defaults[t])?[...defaults[t]]:{...defaults[t]}}this.#config[t]={...defaults[t],...i};break}}else booleanAttrs.includes(t)?this.#config[t]=!1:this.#config[t]=defaults[t]}attributeChangedCallback(e,i,t){if(YahooPixelframeDrive.observedAttributes.includes(e))switch(this.#format(e,i,t),e){case"uploader":Object.keys(this.uploader).forEach(e=>{this.#nodes.uploader[e]=this.uploader[e]});break;case"maxpickcount":this.#nodes.infoMaxPickCount.textContent=this.maxpickcount;break;case"placeholder":this.#nodes.formSearch.querySelector("input[type=search]").placeholder=this.placeholder}}static get observedAttributes(){return Object.keys(defaults)}static get supportedEvents(){return Object.keys(custumEvents).map(e=>custumEvents[e])}#upgradeProperty(e){let i;YahooPixelframeDrive.observedAttributes.includes(e)&&(Object.prototype.hasOwnProperty.call(this,e)?(i=this[e],delete this[e]):i=booleanAttrs.includes(e)?!(!this.hasAttribute(e)&&!this.#config[e]):objectAttrs.includes(e)?this.hasAttribute(e)?this.getAttribute(e):JSON.stringify(this.#config[e]):this.hasAttribute(e)?this.getAttribute(e):this.#config[e],this[e]=i)}set maxuploadcount(e){void 0!==e?this.setAttribute("maxuploadcount",e):this.removeAttribute("maxuploadcount")}get maxuploadcount(){return this.#config.maxuploadcount}set maxpickcount(e){void 0!==e?this.setAttribute("maxpickcount",e):this.removeAttribute("maxpickcount")}get maxpickcount(){return this.#config.maxpickcount}set placeholder(e){void 0!==e?this.setAttribute("placeholder",e):this.removeAttribute("placeholder")}get placeholder(){return this.#config.placeholder}set uploader(e){e?(e={...defaults.uploader,...this.uploader,..."string"==typeof e?JSON.parse(e):e},this.setAttribute("uploader",JSON.stringify(e))):this.removeAttribute("uploader")}get uploader(){return this.#config.uploader}get open(){return this.#nodes.dialogDrive.open}#fireEvent(e,i){this.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0,...i&&{detail:i}}))}#decorateDialog({action:e,data:i}){var{id:i,name:t,description:a,thumbnail:o}=i,r=this.#nodes["dialog"+_wcl.capitalize(e)],n=r.querySelector("[data-ref=id]"),l=r.querySelector("[data-ref=image]"),s=r.querySelector("[data-ref=name]"),c=r.querySelector("[data-ref=description]");return n.value=i,l.src=o,s["edit"===e?"value":"textContent"]=t,c["edit"===e?"value":"textContent"]=a,r}_onGalleryClick(e){var i,t,e=e["target"],a=e.closest("button");a&&({id:e,status:i}=e.closest("[data-id]").dataset,a=a.dataset.action,t=this.#data.listings[e])&&("error"===i&&"delete"===a?this.#deleteUnit(e):this.#decorateDialog({action:a,data:t}).showModal())}#deleteUnit(i){var e=this.#data.orders.findIndex(e=>e===i),t=this.#nodes.gallery.querySelector(`[data-id=${i}]`);-1!=e&&this.#data.orders.splice(e,1),this.#data.listings[i]&&delete this.#data.listings[i],t&&t.classList.add("drive__gallery__unit--remove")}_onAnimationEnd(e){var{animationName:e,target:i}=e;"animate-remove-gallery-unit"===e&&(i.remove(),this.#data.orders.length||this.#nodes.gallery.replaceChildren(),this.#checkBtnPick(),this.#checkUploadCount())}_uploaderHandler(e){var i=e["type"],{uploader:t,gallery:a}=this.#nodes;switch(i){case"yahoo-pixelframe-uploader-process-start":t.inert=!0;break;case"yahoo-pixelframe-uploader-process-end":t.inert=!1;break;case"yahoo-pixelframe-uploader-done":var o=e.detail["results"];o.forEach(e=>{var{result:e,id:i}=e;this.#data.listings[i]&&e&&(this.#data.listings[i].result={...e})}),this.#checkUploadCount();break;case"yahoo-pixelframe-uploader-pick":{var{picked:o=[]}=e.detail;const s=[],c=[];o.forEach(e=>{var{id:i,thumbnail:t}=e;c.push(i),s.push({id:i,thumbnail:t,status:"processing",freeze:!0}),this.#data.listings[i]={...e,status:"processing",description:""}}),this.#data.orders=[...c,...this.#data.orders];o=Mustache.render(templateUnit.innerHTML,{units:s});a.insertAdjacentHTML("afterbegin",o);break}case"yahoo-pixelframe-uploader-progress":var{id:o,progress:r}=e.detail,n=a.querySelector(`[data-id=${o}]`),l=a.querySelector(`[data-id=${o}] msc-circle-progress`);n&&l&&100===(l.value=r)&&(this.#data.listings[o].status="done",n.dataset.status="done",n.querySelector("input").disabled=!1);break;case"yahoo-pixelframe-uploader-error":l=e.detail["id"],r=a.querySelector(`[data-id=${l}]`);r&&(this.#data.listings[l].status="error",r.dataset.status="error",r.querySelector("input").disabled=!0)}}#resetForm(e){var i=e.className.replace(/.*-(.*)/,"$1"),e=e.querySelector("form");this.#decorateDialog({action:i,data:{id:"",name:"",description:"",thumbnail:blankImage}}),this.#clearInvalid(e)}_onDialogsClose(e){e=e.target;const i=e.closest("msc-dialogs");switch(e.className.replace(/.*-(.*)/,"$1")){case"drive":var{dialogEdit:t,dialogDelete:a}=this.#nodes;t.open&&t.close(),a.open&&a.close();break;case"delete":case"edit":setTimeout(()=>{this.#resetForm(i)},400)}}#clearInvalid(e){Array.from(e.querySelectorAll(".input-set__em")).forEach(e=>e.textContent="")}#getWarnElement(e){return e.closest(".input-set").querySelector(".input-set__em")}async _editHandler(e){e.preventDefault();var{type:e,target:i,submitter:t}=e,{dialogEdit:a,formEdit:o}=this.#nodes,r="Input title please.";switch(e){case"input":var n=i.closest("input,textarea"),l=this.#getWarnElement(n),s=!!n.value.trim().length;"name"===n.dataset.ref&&(l.textContent=s?"":r);break;case"submit":this.#clearInvalid(o),"cancel"===t.value?a.close():(n=new FormData(o),!!(l=Object.fromEntries(n.entries())).title.trim().length?(s=l.id,this.#data.listings[s]&&(this.#data.listings[s]={...this.#data.listings[s],name:l.title.trim(),description:l.description.trim()}),a.close()):this.#getWarnElement(o.querySelector("[data-ref=name]")).textContent=r)}}async _deleteHandler(e){e.preventDefault();var e=e["submitter"],{dialogDelete:i,formDelete:t}=this.#nodes,t=new FormData(t),a=Object.fromEntries(t.entries())["id"];switch(e.value){case"cancel":i.close();break;case"submit":this.#deleteUnit(a),i.close()}}_onSearchInput(){var{formSearch:e,gallery:i}=this.#nodes,e=new FormData(e);const t=Object.fromEntries(e.entries()).q.toLowerCase().trim(),a=!t.length;e=this.#data.orders.reduce((e,i)=>{var t,i=this.#data.listings[i];return i?(t=i["status"],e.concat({...i,freeze:"done"!==t})):e},[]),i.replaceChildren(),e=e.filter(({name:e,description:i})=>a||e.toLowerCase().includes(t)||i.toLowerCase().includes(t));e.length&&(e=Mustache.render(templateUnit.innerHTML,{units:e}),i.insertAdjacentHTML("afterbegin",e)),this.#checkBtnPick()}_onSubmit(e){e.preventDefault();var e=this.#nodes["formDriveMain"],e=new FormData(e).getAll("pickedVideoIds");e.length&&(e=e.reduce((e,i)=>{i=(this.#data.listings?.[i]||{}).result;return i?e.concat({...i}):e},[]),this.#fireEvent(custumEvents.pick,{picked:e}),this.close())}_onPick(e){var e=e.target.closest("input"),{formDriveMain:i,infoPickCount:t}=this.#nodes;let a=new FormData(i).getAll("pickedVideoIds").length;a>this.maxpickcount&&(e.checked=!1,a--),t.textContent=a,this.#checkBtnPick()}#checkBtnPick(){var{formDriveMain:e,btnPick:i}=this.#nodes,e=new FormData(e).getAll("pickedVideoIds");i.inert=!(0<e.length)}#checkUploadCount(){var{uploader:e,gallery:i}=this.#nodes,i=Array.from(i.querySelectorAll("[data-status=done]")).length;e.inert=i>this.maxuploadcount}_onDnD(e){var i=e["type"],{drive:t,uploader:a}=this.#nodes;switch(i){case"dragover":e.preventDefault();break;case"drop":var o=e["dataTransfer"];if(e.preventDefault(),this.#data.dragCount=0,a.inert)return;t.classList.toggle("drive--over",!1),a.passFiles(o.files);break;case"paste":o=e.clipboardData||window.clipboardData;document.body.focus(),a.inert||a.passFiles(o.files)}}_hintHandler(e){var e=e["type"],{drive:i,uploader:t}=this.#nodes;switch(e){case"dragenter":this.#data.dragCount++;case"dragover":this.open&&!t.inert&&i.classList.toggle("drive--over",!0);break;case"dragleave":(!isSafari||(this.#data.dragCount--,0===this.#data.dragCount))&&i.classList.toggle("drive--over",!1)}}close(){this.#nodes.dialogDrive.close()}showModal(){this.#nodes.dialogDrive.showModal()}}const S=_wcl.supports(),T=_wcl.classToTagName("YahooPixelframeDrive");S.customElements&&S.shadowDOM&&S.template&&!window.customElements.get(T)&&window.customElements.define(_wcl.classToTagName("YahooPixelframeDrive"),YahooPixelframeDrive);export{YahooPixelframeDrive};